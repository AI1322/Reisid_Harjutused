<!DOCTYPE html>
<html lang="ee">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reisid JSON</title>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <link rel="stylesheet" href="styles.css" />
    <script>
        $(document).ready(function () {
            $.ajax({
                type: "GET",
                url: "Reisid.json",
                dataType: "json",
                success: KuvaJson,
                error: vigaJson,
            });
        });

        function vigaJson() {
            $("#container").append('<p style="color:red;">Probleemid JSON failiga!</p>');
        }

        function KuvaJson(json) {
            var table = '<table border="1">' +
                '<tr>' +
                '<th>ID</th>' +
                '<th>Reisi number</th>' +
                '<th>Firma</th>' +
                '<th>Sihtkoht</th>' +
                '<th>Kestus</th>' +
                '<th>Väljumine</th>' +
                '<th>Saabumine</th>' +
                '<th>Hind</th>' +
                '<th>Kogumaksumus</th>' +
                '</tr>';

            $.each(json.Reisid.Reis, function (i, reis) {
                var id = reis['@attributes'].id;
                var reisi_number = reis['@attributes'].reisi_number;
                var firma = reis.Firma;
                var sihtkoht = reis.Sihtkoht;
                var kestus = reis.Lennujaamad['@attributes'].kestus;
                var valjumine = reis.Lennujaamad.Valjumine;
                var saabumine = reis.Lennujaamad.Saabumine;
                var hind = reis.Hind['@attributes'].value;

                // Считаем общую стоимость
                var transpordiHind = parseFloat(reis.Transport['@attributes'].value);
                var majutus = parseFloat(reis.Majutus['@attributes'].value);
                var ekskursioon = parseFloat(reis.Ekskursioonid['@attributes'].value);
                var muud = parseFloat(reis.MuudKulud['@attributes'].value);
                var kogumaksumus = transpordiHind + majutus + ekskursioon + muud;

                table +=
                    '<tr>' +
                    '<td>' + id + '</td>' +
                    '<td>' + reisi_number + '</td>' +
                    '<td>' + firma + '</td>' +
                    '<td>' + sihtkoht + '</td>' +
                    '<td>' + kestus + '</td>' +
                    '<td>' + valjumine + '</td>' +
                    '<td>' + saabumine + '</td>' +
                    '<td>' + hind + ' €</td>' +
                    '<td>' + kogumaksumus + ' €</td>' +
                    '</tr>';
            });

            table += '</table>';
            $("#container").append(table);
        }
    </script>
</head>
<body>
<nav>
    <ul>
        <li><a href="index.php">Avaleht</a></li>
        <li><a href="Reisid_jquery.html">Reisid</a></li>
    </ul>
</nav>
<h1 class="failid">Reisid (JSON)</h1>
<div id="container"></div>
</body>
</html>
